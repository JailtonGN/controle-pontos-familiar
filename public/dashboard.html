<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Controle de Pontos Familiar</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="assets/logo.png">
</head>
<body>
    <!-- Modern Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-content">
                <!-- Brand -->
                <div class="navbar-brand">
                    <div class="navbar-logo"></div>
                    <div>
                        <div class="navbar-title">Dashboard</div>
                        <div class="navbar-subtitle">Sistema de Pontos</div>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="navbar-menu">
                    <div class="navbar-item">
                        <a href="/dashboard" class="navbar-button active" id="nav-dashboard">
                            <span class="navbar-button-text">Tela Inicial</span>
                        </a>
                    </div>
                    <div class="navbar-item">
                        <a href="/manage-points" class="navbar-button" id="nav-activities">
                            <span class="navbar-button-text">Atividades</span>
                        </a>
                    </div>
                    <div class="navbar-item">
                        <a href="/kids" class="navbar-button" id="nav-kids">
                            <span class="navbar-button-text">Cadastros</span>
                        </a>
                    </div>
                    <div class="navbar-item">
                        <a href="/communication" class="navbar-button" id="nav-communication">
                            <span class="navbar-button-text">Comunica√ß√£o</span>
                        </a>
                    </div>
                    <div class="navbar-item">
                        <a href="/config" class="navbar-button" id="nav-settings">
                            <span class="navbar-button-text">Configura√ß√£o</span>
                        </a>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="navbar-user">
                    <span id="user-name" class="navbar-user-name"></span>
                    <button onclick="logout()" class="navbar-button navbar-button-logout">
                        Sair
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="navbar-mobile-menu">
                    <button class="navbar-mobile-button" onclick="toggleMobileMenu()">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="navbar-mobile-menu-content hidden">
                <a href="/dashboard" class="navbar-mobile-item active" onclick="setActiveNav('nav-dashboard')">
                    Tela Inicial
                </a>
                <a href="/manage-points" class="navbar-mobile-item" onclick="setActiveNav('nav-activities')">
                    Atividades
                </a>
                <a href="/kids" class="navbar-mobile-item" onclick="setActiveNav('nav-kids')">
                    Cadastros
                </a>
                <a href="/communication" class="navbar-mobile-item" onclick="setActiveNav('nav-communication')">
                    Comunica√ß√£o
                </a>
                <a href="/config" class="navbar-mobile-item" onclick="setActiveNav('nav-settings')">
                    Configura√ß√£o
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-top: 32px; padding-bottom: 32px;">
        <!-- Cards de Pontos das Crian√ßas -->
        <div class="professional-section">
            <div class="professional-card">
                <div class="professional-card-header">
                    <div class="professional-card-title">
                        üèÜ Pontua√ß√£o das Crian√ßas
                    </div>
                    <div class="professional-card-subtitle">Acompanhe o progresso de cada crian√ßa</div>
                </div>
                <div class="professional-card-body">
                    <div id="kids-points-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Cards das crian√ßas ser√£o carregados aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Hist√≥rico de Atividades -->
        <div class="professional-section">
            <div class="professional-card">
                <div class="professional-card-header">
                    <div class="professional-card-title">
                        üìä Hist√≥rico de Atividades
                    </div>
                    <div class="professional-card-subtitle">Acompanhe todas as atividades registradas</div>
                </div>
                <div class="professional-card-body">
                    <!-- Filtros -->
                    <div class="history-filters">
                        <div class="history-filters-grid">
                            <div class="history-filter-group">
                                <label for="filter-kid" class="history-filter-label">Crian√ßa</label>
                                <select id="filter-kid" class="history-filter-input">
                                    <option value="">Todas as crian√ßas</option>
                                </select>
                            </div>
                            <div class="history-filter-group">
                                <label for="filter-date" class="history-filter-label">Data</label>
                                <input type="date" id="filter-date" class="history-filter-input">
                            </div>
                            <div class="history-filter-group">
                                <button id="apply-filters-btn" onclick="applyFilters(); console.log('üîé [PARENT UI] Clicou Filtrar', {kid: document.getElementById('filter-kid')?.value, date: document.getElementById('filter-date')?.value});" class="professional-button professional-button-secondary">
                                    üîç Filtrar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cards de Hist√≥rico -->
                    <div id="history-cards" class="space-y-4">
                        <!-- Cards ser√£o carregados aqui -->
                    </div>
                    
                    <!-- Estado vazio -->
                    <div id="history-empty" class="history-empty hidden">
                        <div class="history-empty-icon">üìù</div>
                        <h3>Nenhuma atividade registrada</h3>
                        <p>Comece a registrar atividades para ver o hist√≥rico aqui</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Adicionar Crian√ßa -->
    <div id="add-kid-modal" class="modal hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Adicionar Crian√ßa</h3>
                    <button onclick="hideAddKidModal()" class="text-gray-400 hover:text-gray-600">
                        <span class="text-2xl">√ó</span>
                    </button>
                </div>
                <form id="add-kid-form" class="space-y-4">
                    <div>
                        <label for="kid-name" class="block text-sm font-medium text-gray-700">Nome</label>
                        <input type="text" id="kid-name" name="name" required class="input">
                    </div>
                    <div>
                        <label for="kid-age" class="block text-sm font-medium text-gray-700">Idade</label>
                        <input type="number" id="kid-age" name="age" min="1" max="18" required class="input">
                    </div>
                    <div>
                        <label for="kid-avatar" class="block text-sm font-medium text-gray-700">Avatar (emoji)</label>
                        <input type="text" id="kid-avatar" name="avatar" placeholder="üë∂" class="input">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideAddKidModal()" class="btn btn-secondary">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script src="js/toast.js"></script>
    <script>
        // API espec√≠fica para crian√ßas
        const KidAPI = {
            baseURL: '/api',
            
            async request(endpoint, options = {}) {
                const url = this.baseURL + endpoint;
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };

                const token = localStorage.getItem('kidToken');
                if (token) {
                    config.headers.Authorization = `Bearer ${token}`;
                }

                try {
                    const response = await fetch(url, config);
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Erro na requisi√ß√£o');
                    }
                    
                    return data;
                } catch (error) {
                    console.error('Erro na API:', error);
                    throw error;
                }
            },

            async get(endpoint) {
                return this.request(endpoint, { method: 'GET' });
            }
        };

        // Verificar se √© uma crian√ßa e adaptar interface
        document.addEventListener('DOMContentLoaded', function() {
            const kidData = localStorage.getItem('kidData');
            const kidToken = localStorage.getItem('kidToken');
            
            if (kidData && kidToken) {
                // √â uma crian√ßa - adaptar interface
                adaptDashboardForKid();
            }
        });

        // Adaptar dashboard para crian√ßa
        function adaptDashboardForKid() {
            console.log('Adaptando dashboard para crian√ßa');
            
            // Ocultar navega√ß√£o dos pais
            const navbar = document.querySelector('.navbar');
            if (navbar) {
                navbar.style.display = 'none';
            }
            
            // Adicionar header da crian√ßa
            const body = document.body;
            const header = document.createElement('header');
            header.className = 'kid-header';
            header.innerHTML = `
                <div class="kid-header-content">
                    <div class="kid-info">
                        <div class="kid-avatar" id="kid-avatar">üë∂</div>
                        <div class="kid-details">
                            <h1 id="kid-name">Carregando...</h1>
                            <p id="kid-age">Idade: -- anos</p>
                        </div>
                    </div>
                    <div class="kid-actions">
                        <button id="communication-btn" class="action-button">
                            <span class="action-icon">üí¨</span>
                            Comunica√ß√£o
                        </button>
                        <button id="logout-btn" class="logout-button">
                            <span class="logout-icon">üö™</span>
                            Sair
                        </button>
                    </div>
                </div>
            `;
            
            body.insertBefore(header, body.firstChild);
            
            // Carregar dados da crian√ßa
            loadKidDashboardData();
            
            // Event listeners para crian√ßa
            document.getElementById('communication-btn').addEventListener('click', function() {
                window.location.href = '/communication';
            });
            
            document.getElementById('logout-btn').addEventListener('click', function() {
                logout();
            });
            
            // Adaptar conte√∫do principal
            adaptMainContentForKid();
        }

        // Carregar dados do dashboard da crian√ßa
        async function loadKidDashboardData() {
            try {
                const kidData = JSON.parse(localStorage.getItem('kidData'));
                const response = await KidAPI.get(`/auth/kid/profile`);
                const kid = response.data.kid;
                
                document.getElementById('kid-avatar').textContent = kid.emoji || 'üë∂';
                document.getElementById('kid-name').textContent = kid.name;
                document.getElementById('kid-age').textContent = `Idade: ${kid.age} anos`;
                
            } catch (error) {
                console.error('Erro ao carregar dados da crian√ßa:', error);
            }
        }

        // Adaptar conte√∫do principal para crian√ßa
        function adaptMainContentForKid() {
            const main = document.querySelector('main');
            if (!main) return;
            
            main.innerHTML = `
                <div class="container" style="padding-top: 32px; padding-bottom: 32px;">
                    <div class="professional-section">
                        <div class="professional-card">
                            <div class="professional-card-header">
                                <div class="professional-card-title">
                                    <h2>üéØ Seus Pontos</h2>
                                </div>
                            </div>
                            <div class="professional-card-body">
                                <div id="kid-points-display" class="text-center py-8">
                                    <div class="text-6xl font-bold text-blue-600 mb-4" id="kid-total-points">0</div>
                                    <div class="text-xl text-gray-600 mb-6">Pontos Totais</div>
                                    <div class="bg-blue-100 rounded-lg p-4">
                                        <div class="text-lg font-semibold text-blue-800 mb-2" id="kid-level">N√≠vel 1</div>
                                        <div class="w-full bg-blue-200 rounded-full h-3">
                                            <div class="bg-blue-600 h-3 rounded-full" id="kid-progress" style="width: 0%"></div>
                                        </div>
                                        <div class="text-sm text-blue-600 mt-2" id="kid-progress-text">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Carregar dados dos pontos
            loadKidPoints();
        }

        // Carregar pontos da crian√ßa
        async function loadKidPoints() {
            try {
                const kidData = JSON.parse(localStorage.getItem('kidData'));
                const response = await KidAPI.get(`/auth/kid/profile`);
                const kid = response.data.kid;
                
                const totalPoints = kid.totalPoints || 0;
                const level = Math.floor(totalPoints / 100) + 1;
                const progressInLevel = totalPoints % 100;
                const progressPercentage = Math.min(100, (progressInLevel / 100) * 100);
                
                document.getElementById('kid-total-points').textContent = totalPoints;
                document.getElementById('kid-level').textContent = `N√≠vel ${level}`;
                document.getElementById('kid-progress').style.width = `${progressPercentage}%`;
                document.getElementById('kid-progress-text').textContent = `${Math.round(progressPercentage)}%`;
                
            } catch (error) {
                console.error('Erro ao carregar pontos da crian√ßa:', error);
            }
        }

        // Logout para crian√ßa
        function logout() {
            localStorage.removeItem('kidData');
            localStorage.removeItem('kidToken');
            window.location.href = '/';
        }
    </script>
</body>
</html> 